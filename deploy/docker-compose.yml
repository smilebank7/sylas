networks:
  traefik-public:
    external: true

services:
  sylas:
    image: ghcr.io/smilebank7/sylas:latest
    container_name: sylas
    restart: unless-stopped
    command: ["sylas", "start"]
    env_file:
      - .env
    volumes:
      - sylas-data:/root/.sylas
      - sylas-repos:/root/.sylas/repos
      - opencode-data:/root/.local/share/opencode
    networks:
      - traefik-public
    labels:
      - traefik.enable=true
      - "traefik.http.routers.sylas.rule=Host(`${SYLAS_DOMAIN:-sylas.example.com}`)"
      - traefik.http.routers.sylas.entrypoints=websecure
      - traefik.http.routers.sylas.tls.certresolver=myresolver
      - traefik.http.services.sylas.loadbalancer.server.port=3456
      - "traefik.http.routers.sylas-http.rule=Host(`${SYLAS_DOMAIN:-sylas.example.com}`)"
      - traefik.http.routers.sylas-http.entrypoints=web
      - traefik.http.middlewares.sylas-redirect.redirectscheme.scheme=https
      - traefik.http.routers.sylas-http.middlewares=sylas-redirect

volumes:
  sylas-data:
  sylas-repos:
  opencode-data:
